{"version":3,"sources":["../../src/utils/security.js"],"names":["getPermissions","user","securitySchema","accessModifiers","roles","reduce","resultPermissions","curRole","curRolePermissions","mergedPermissions","mergeResult","modifier","prevPermValue","curPermValue","valueType","Error","mergeValue","push"],"mappings":";;;;;;;;;;;;;;AAAO,IAAMA,0CAAiB,SAAjBA,cAAiB,CAACC,IAAD,EAAOC,cAAP,EAA8C;AAAA,sCAApBC,eAAoB;AAApBA,uBAAoB;AAAA;;AAExE,WAAOF,KAAKG,KAAL,CAAWC,MAAX,CAAkB,UAACC,iBAAD,EAAoBC,OAApB,EAAgC;;AAErD,YAAMC,qBAAqBN,eAAeK,OAAf,KAA2B,EAAtD;AACA,YAAME,oBAAoBN,gBAAgBE,MAAhB,CAAuB,UAACK,WAAD,EAAcC,QAAd,EAA2B;AAAA;;AAExE,gBAAMC,gBAAgBN,kBAAkBK,QAAlB,CAAtB;AACA,gBAAIE,eAAeL,mBAAmBG,QAAnB,KACdJ,YAAY,OAAZ,IAAuB,IADT,IAEdK,kBAAkB,IAAlB,IAA0B,IAFZ,IAGf,KAHJ;AAIA,gBAAME,mBAAmBD,YAAnB,yCAAmBA,YAAnB,CAAN;;AAEA,gBAAIC,cAAc,UAAlB,EAA8BD,eAAeA,aAAaZ,IAAb,CAAf;AAC9B,gBAAIW,iBAAiB,QAAOA,aAAP,yCAAOA,aAAP,eAAiCC,YAAjC,yCAAiCA,YAAjC,EAArB,EAAqE,MAAM,IAAIE,KAAJ,CAAU,YAAV,CAAN;;AAErE,gBAAIC,mBAAJ;AACA,oBAAQF,SAAR;AACI,qBAAK,QAAL;AACIE,8CAAkBJ,aAAlB,EAAoCC,YAApC;AACA;AACJ,qBAAK,UAAL;AACIG,iCAAa,EAAb;AACAJ,qCAAiB,2BAAWK,IAAX,uCAAmBL,aAAnB,EAAjB;AACAI,+BAAWC,IAAX,CAAgBJ,YAAhB;AACA;AACJ;AACIG,iCAAaH,YAAb;AAVR;;AAaA,gCAAYH,WAAZ,sBAA0BC,QAA1B,EAAqCK,UAArC;AAEH,SA5ByB,EA4BvB,EA5BuB,CAA1B;AA6BA,4BAAYV,iBAAZ,EAAkCG,iBAAlC;AACH,KAjCM,EAiCJ,EAjCI,CAAP;AAmCH,CArCM","file":"security.js","sourcesContent":["export const getPermissions = (user, securitySchema, ...accessModifiers) => {\n\n    return user.roles.reduce((resultPermissions, curRole) => {\n\n        const curRolePermissions = securitySchema[curRole] || { };\n        const mergedPermissions = accessModifiers.reduce((mergeResult, modifier) => {\n\n            const prevPermValue = resultPermissions[modifier];\n            let curPermValue = curRolePermissions[modifier] ||\n                (curRole === \"ADMIN\" && true) ||\n                (prevPermValue === true && true) ||\n                false;\n            const valueType = typeof(curPermValue);\n\n            if (valueType === \"function\") curPermValue = curPermValue(user);\n            if (prevPermValue && typeof(prevPermValue) !== typeof(curPermValue)) throw new Error(\"MixedTypes\");\n\n            let mergeValue;\n            switch (valueType) {\n                case \"object\":\n                    mergeValue = { ...prevPermValue, ...curPermValue };\n                    break;\n                case \"function\":\n                    mergeValue = [];\n                    prevPermValue && mergeValue.push(...prevPermValue);\n                    mergeValue.push(curPermValue);\n                    break;\n                default:\n                    mergeValue = curPermValue;\n            }\n\n            return { ...mergeResult, [modifier]: mergeValue };\n\n        }, { });\n        return { ...resultPermissions, ...mergedPermissions };\n    }, { });\n\n};"]}